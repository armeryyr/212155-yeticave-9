CREATE DATABASE yeticave
DEFAULT CHARACTER SET utf8
DEFAULT COLLATE utf8_general_ci;
USE yeticave;

CREATE TABLE categories (
  id INT AUTO_INCREMENT PRIMARY KEY,
  name VARCHAR(128) NOT NULL UNIQUE,
  class VARCHAR(128) NOT NULL UNIQUE
);
CREATE TABLE user (
  id INT AUTO_INCREMENT PRIMARY KEY,
   date_creation TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
   user_name VARCHAR(128) NOT NULL,
   email VARCHAR(128) NOT NULL UNIQUE,
   password VARCHAR(64) NOT NULL,
   avatar VARCHAR(128),
   contact VARCHAR(256) NOT NULL
);
CREATE TABLE lots (
  id INT AUTO_INCREMENT PRIMARY KEY,
  date_creation TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  name VARCHAR(128) NOT NULL,
  description TEXT NOT NULL,
  img VARCHAR(128) NOT NULL,
  price_initial INT NOT NULL,
  data_end TIMESTAMP NOT NULL,
  step_rate INT NOT NULL,
  user_id INT NOT NULL,
  cat_id INT NOT NULL,
  user_winner_id INT,
  FOREIGN KEY (user_id) REFERENCES user(id),
  FOREIGN KEY (cat_id) REFERENCES categories(id),
  FOREIGN KEY (user_winner_id) REFERENCES user(id)
);
CREATE TABLE rate (
  id INT AUTO_INCREMENT PRIMARY KEY,
  date_creation TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  price_user INT NOT NULL,
  user_id INT NOT NULL,
  lot_id INT NOT NULL,
  FOREIGN KEY (user_id) REFERENCES user(id),
  FOREIGN KEY (lot_id) REFERENCES lots(id)
);